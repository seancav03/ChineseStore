<html lang="en" class="gr__getbootstrap_com">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link href="https://getbootstrap.com/docs/4.0/examples/navbar-fixed/navbar-top-fixed.css" rel="stylesheet">
<link href="https://getbootstrap.com/docs/4.0/examples/grid/grid.css" rel="stylesheet">

<style type="text/css">

div.parentCol{
    background-color: rgb(255, 255, 255);
}

main.offtop{
    margin-top: 110px;
}

h1.number{
    font-size: 1rem;
    font-weight: 400;
}

div.labels{
    font-size: 1.25rem;
    font-weight: 500;
}

div.column{
    float: left;
    width: 25%;
}

div.named{
    font-size: 1.5rem;
    font-weight: 600!important;
}

div.centerChanges{

}

button.invis{
    background-color: transparent!important;
    border: 1px solid rgba(86, 61, 124, .3);

}

button.edit{
    background-color: transparent!important;
    border: 0px solid rgba(86, 61, 124, .3);
    color: rgb(45, 42, 235);
}

button.classes{
    background-color: rgba(86, 61, 124, .5);;
    border: 1px solid rgba(86, 61, 124, .6);
    font-size: 1.5rem;
}

div.bordered{
    background-color: rgba(86, 61, 124, .15);
    border: 1px solid rgba(86, 61, 124, .2);
}

div.text{
    background-color: rgb(73, 31, 75);
    margin-bottom: 20px;
    text-align:center;
    font-size: 1.75rem;
    font-weight: 400!important;
    font-family: sans-serif;
}

div.seperate{
    margin-bottom: 50px;
    margin-top: 25px;
}

div#elements{
    border: 5px!important;
    border-color: rgb(73, 31, 75)!important;
}

div.title{
    font-size: 2.7rem;
    font-weight: 500!important;
    margin-bottom: 15px;
}

div.changeBox{
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 70%; /* Could be more or less, depending on screen size */
    text-align: center
}

div.popup{
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 9; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w*/
}

a.bolded{
    font-size: 1.75rem!important;
}

nav.theme{
    background-color: rgb(73, 31, 75)!important;
}
div#title{
    color: rgb(253, 253, 253);
}

body{
    margin: 0;
    padding: 0;
}

input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
  -webkit-appearance: none; 
  margin: 0; 
}

input.nums{
    max-width: 40;
    margin-bottom: 0.5rem;
    text-align: center;
}

</style>



</head>
<body >
    <nav class="navbar navbar-expand-md navbar-dark fixed-top theme">
        <a class="navbar-brand bolded" href="#">Awesomeness Store</a>
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="navbarCollapse">
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="javascript:document.location.href = 'teacherStore.htm'">Store</a>
                <a class="nav-item nav-link active" href="">Classes<span class="sr-only">(current)</span></a>
                <a class="nav-item nav-link" href="javascript:document.location.href = 'teacherPendingRewards.htm'">Pending Rewards</a>
            </div>
        </div>
    </nav>

    <main role="main" class="container offtop" id="main">
        <div class="text-center title">
                Classes
        </div>
        <div class="row text-center seperate">
            <div class="text-center column">
                <button class="btn classes" onclick="toClass(this.innerText)">Chinese 3</button>
            </div>

            <div class="text-center column">
                <button class="btn classes" onclick="toClass(this.innerText)">Chinese 4</button>
            </div>
            <div class="text-center column">
                <button class="btn classes" onclick="toClass(this.innerText)">Chinese 5</button>
            </div>
    
            <div class="text-center column">
                <button class="btn classes" onclick="toClass(this.innerText)">Chinese AP</button>
            </div>
        </div> 
        <div id="content">
            <div class="row centered">
                <div class="col-4 column text-center bordered labels">
                    Name 
                </div>
            
                <div class="col-4 column text-center bordered labels">
                    Golden Points
                </div>

                <div class=" col-4 column text-center bordered labels">
                    Awesome Points
                </div>
            </div>
            
            <div id="students" class="row centered">
                

            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script type='text/javascript'>
        let currClass
        let email
        let password
        let allStudents
        let currForm
        let studentEdit
        let studentEditEmail

        function getCredentials(){
            let promise = new Promise(function(resolve, reject){
                fetch("/cookieAuthenticate", {
                method: 'POST', 
                }).then(result => {
                    result.json().then(result2 => {
                        if(result2.LoggedIn == false || result2.isAdmin == false){
                            document.location.href = 'login.htm'
                        } else {
                            resolve(result2);
                        }
                    }).catch(result => {
                    console.log("ERROR - parsing JSON")
                    })
                }).catch(result => {
                    console.log("ERROR - getting cookieAuthenticate")
                })
            })
            return promise;
        } 

        $("div#content").on('focusout', '.nums', function(){
            changeValue(event.target.parentElement, event.target.value)
        })

        window.onload = function(){
            let promise = getCredentials();
            promise.then(creds => {
                email = creds.Username;
                password = creds.Password;
            })
        }
        
        function toClass(className){
            //get array by class name
            currClass = className;
            let students = []
            
            //students.push(student1)
            //students.push(student2)
            //students.push(student3)

            fetch("/getStudentsByClass", {
                method: 'POST',
                headers: {
                    //'Content-Type': 'application/url',
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: "AdminU=" + email + "&AdminP=" + password + "&Class=" + className, // body data type must match "Content-Type" header
            })
            .then(function (result) {
                result.json().then(function(result2){
                    students = result2.data;
                    allStudents = students
                    let table = document.getElementById("students")

                    let content = document.getElementById("content")

                    let last = table.lastElementChild
                    while(last){
                        last.remove()
                        last = table.lastElementChild
                    }

                    for(let i = 0; i < students.length; i++){

                        let popup = document.createElement('div')
                        popup.className = "popup"
                        popup.id = students[i][0] + "change"

                        let changeInfo = document.createElement('div')
                        changeInfo.className = "changeBox"

                        let emailLabel = document.createElement('label')
                        emailLabel.innerHTML = "Email &nbsp &nbsp"
                        let emailInput = document.createElement('input')
                        emailInput.value = students[i][0]

                        let break1 = document.createElement('br')

                        let nameLabel = document.createElement('label')
                        nameLabel.innerHTML = "Name &nbsp &nbsp"
                        let nameInput = document.createElement('input')
                        nameInput.value = students[i][1]

                        let break2 = document.createElement('br')

                        let passwordLabel = document.createElement('label')
                        passwordLabel.innerHTML = "Password &nbsp &nbsp"
                        let passwordInput = document.createElement('input')
                        //dont have access to password here

                        let break3 = document.createElement('br')

                        let classLabel = document.createElement('label')
                        classLabel.innerHTML = "Class &nbsp &nbsp"
                        let classInput = document.createElement('select')
                        let chinese3 = document.createElement('option')
                        chinese3.text = "Chinese 3"
                        let chinese4 = document.createElement('option')
                        chinese4.text = "Chinese 4"
                        let chinese5 = document.createElement('option')
                        chinese5.text = "Chinese 5"
                        let chineseap = document.createElement('option')
                        chineseap.text = "Chinese AP"
                        classInput.appendChild(chinese3)
                        classInput.appendChild(chinese4)
                        classInput.appendChild(chinese5)
                        classInput.appendChild(chineseap)


                        classInput.value = students[i][3]

                        let break4 = document.createElement('br')

                        let done = document.createElement('button')
                        done.innerText = "Done"
                        done.id = students[i][0]
                        done.onclick = function(){
                            let newEmail = currForm.children[0].children[1].value
                            let newName = currForm.children[0].children[4].value
                            let newPassword = currForm.children[0].children[7].value
                            let newClass = currForm.children[0].children[10].value

                            let oldGol
                            let oldAwe
                            let oldPsw 

                            for(let j = 0; j< students.length; j++){
                                if(students[j][1] == studentEdit){
                                    oldAwe = students[j][4]
                                    oldGol = students[j][5]
                                    break;
                                }
                            }

                            fetch("/getStudent", {
                                method: 'POST',
                                headers: {
                                //'Content-Type': 'application/url',
                                'Content-Type': 'application/x-www-form-urlencoded',
                                },
                                body: "username=" + studentEdit + "&password=" + password, // body data type must match "Content-Type" header
                            })
                            .then(function (result) {
                                result.json().then(function(result2){
                                    studentInfo = result2.data;
                                    oldPsw = studentInfo[2]
                                })
                            })
                            if(newPassword != ""){      
                                fetch("/removeStudent", {
                                    method: 'POST',
                                    headers: {
                                    //'Content-Type': 'application/url',
                                    'Content-Type': 'application/x-www-form-urlencoded',
                                    },
                                    body: "AdminU=" + email + "&AdminP=" + password + "&studentName=" + studentEdit, // body data type must match "Content-Type" header
                                })
                                .then(function (result) {
                                    fetch("/newStudent", {
                                        method: 'POST',
                                        headers: {
                                        //'Content-Type': 'application/url',
                                        'Content-Type': 'application/x-www-form-urlencoded',
                                        },
                                        body: "email=" + newEmail + "&name=" + newName + "&password=" + newPassword + "&className=" + newClass + "&numGol=" + oldGol + "&numAwe=" + oldAwe, // body data type must match "Content-Type" header
                                    })
                                    .then(function (result) {
                                        //document.getElementById((studentEditEmail + "change")).style.display = "none";
                                        toClass(currClass) 
                                    })
                                })
                            }else if(newEmail == "" || newName == ""){
                                fetch("/removeStudent", {
                                    method: 'POST',
                                    headers: {
                                    //'Content-Type': 'application/url',
                                    'Content-Type': 'application/x-www-form-urlencoded',
                                    },
                                    body: "AdminU=" + email + "&AdminP=" + password + "&studentName=" + studentEdit, // body data type must match "Content-Type" header
                                })
                            }else if(password == ""){
                                fetch("/removeStudent", {
                                    method: 'POST',
                                    headers: {
                                    //'Content-Type': 'application/url',
                                    'Content-Type': 'application/x-www-form-urlencoded',
                                    },
                                    body: "AdminU=" + email + "&AdminP=" + password + "&studentName=" + studentEdit, // body data type must match "Content-Type" header
                                })
                                .then(function (result) {
                                    fetch("/newStudent", {
                                        method: 'POST',
                                        headers: {
                                        //'Content-Type': 'application/url',
                                        'Content-Type': 'application/x-www-form-urlencoded',
                                        },
                                        body: "email=" + newEmail + "&name=" + newName + "&password=" + oldPsw + "&className=" + newClass + "&numGol=" + oldGol + "&numAwe=" + oldAwe, // body data type must match "Content-Type" header
                                    })
                                    .then(function (result) {
                                        //document.getElementById((studentEditEmail + "change")).style.display = "none";
                                        toClass(currClass) 
                                    })
                                })
                            }
                        }

                        changeInfo.appendChild(emailLabel)
                        changeInfo.appendChild(emailInput)
                        changeInfo.appendChild(break1)
                        changeInfo.appendChild(nameLabel)
                        changeInfo.appendChild(nameInput)
                        changeInfo.appendChild(break2)
                        changeInfo.appendChild(passwordLabel)
                        changeInfo.appendChild(passwordInput)
                        changeInfo.appendChild(break3)
                        changeInfo.appendChild(classLabel)
                        changeInfo.appendChild(classInput)
                        changeInfo.appendChild(break4)
                        changeInfo.appendChild(done)

                        popup.appendChild(changeInfo)
                        content.insertBefore(popup, content.childNodes[0])

                        let name = document.createElement('div')
                        // name.textContent = students[i]["name"]
                        let nameText = document.createElement('div')
                        nameText.textContent = students[i][1]
                        name.className = 'col-4 column text-center bordered'
                        let brk0 = document.createElement('br')
                        let editButton = document.createElement('button')
                        editButton.id = students[i][0]
                        editButton.textContent = "edit"
                        editButton.className = 'edit'
                        editButton.onclick = function(){
                            currForm = document.getElementById((this.id + "change"))
                            currForm.style.display = "block";
                            studentEdit = currForm.children[0].children[4].value
                            studentEditEmail = currForm.children[0].children[2].value
                        }
                        
                        //openForm(editButton.id)

                        name.appendChild(nameText)
                        name.append(brk0)
                        name.appendChild(editButton)

                        table.appendChild(name)

                        let goldenness = document.createElement('div')
                        goldenness.className = 'col-4 column text-center bordered'
                        goldenness.id = "golden"

                        let goldenInput = document.createElement("input")
                        goldenInput.type = 'number'
                        goldenInput.className = 'nums'
                        // goldenInput.value = students[i]["goldenPoints"]
                        goldenInput.value = students[i][5]
                        let brk2 = document.createElement('br')
                        let downButton = document.createElement('button')
                        downButton.className = 'btn invis'
                        downButton.onclick = function(){
                            lower(this.parentElement, 1)
                        }
                        downButton.textContent = "-"
                        let upButton = document.createElement('button')
                        upButton.className = 'btn invis'
                        upButton.onclick = function(){
                            higher(this.parentElement, 1)
                        }
                        upButton.textContent = "+"

                        goldenness.appendChild(goldenInput)
                        goldenness.append(brk2)
                        goldenness.appendChild(downButton)
                        goldenness.appendChild(upButton)

                        table.appendChild(goldenness)

                        let awesomeness = document.createElement('div')
                        awesomeness.className = 'col-4 column text-center bordered'
                        awesomeness.id = "awesome"

                        let awesomeInput = document.createElement("input")
                        awesomeInput.type = 'number'
                        awesomeInput.className = 'nums'
                        // awesomeInput.value = students[i]["awesomePoints"]
                        awesomeInput.value = students[i][4]
                        let brk = document.createElement('br')
                        let downButton2 = document.createElement('button')
                        downButton2.className = 'btn invis'
                        downButton2.onclick = function(){
                            lower(this.parentElement, 1)
                        }
                        downButton2.textContent = "-"
                        let upButton2 = document.createElement('button')
                        upButton2.className = 'btn invis'
                        upButton2.onclick = function(){
                            higher(this.parentElement, 1)
                        }
                        upButton2.textContent = "+"

                        awesomeness.appendChild(awesomeInput)
                        awesomeness.appendChild(brk)
                        awesomeness.appendChild(downButton2)
                        awesomeness.appendChild(upButton2)
                        
                        table.appendChild(awesomeness)
                    }

                })
            })
        }
        function higher(par, num){
            let student = ""
            let studentEmail = ""
            if((par.id) == "golden"){
                for(let i = 0; i < par.parentElement.children.length; i++){
                    if(par.parentElement.children[i] == par){
                        let content = par.parentElement.children[i-1].textContent
                        student = content.substring(0, content.length-4)
                        break;
                    }
                }

                for(let i = 0; i < allStudents.length; i++){
                    if(allStudents[i][1] == student){
                        studentEmail = allStudents[i][0]
                        break
                    }
                }

                fetch("/addPoints", {
                    method: 'POST',
                    headers: {
                        //'Content-Type': 'application/url',
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: "AdminU=" + email + "&AdminP=" + password + "&username=" + studentEmail + "&numPoints=" + num + "&areGolden=" + "true", // body data type must match "Content-Type" header
                })
                .then(function (result) {
                    toClass(currClass)
                })
                        
            }else{
                for(let i = 0; i < par.parentElement.children.length; i++){
                    if(par.parentElement.children[i] == par){
                        let content = par.parentElement.children[i-2].textContent
                        student = content.substring(0, content.length-4)
                        break;
                    }
                }

                for(let i = 0; i < allStudents.length; i++){
                    if(allStudents[i][1] == student){
                        studentEmail = allStudents[i][0]
                        break
                    }
                }

                fetch("/addPoints", {
                    method: 'POST',
                    headers: {
                        //'Content-Type': 'application/url',
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: "AdminU=" + email + "&AdminP=" + password + "&username=" + studentEmail + "&numPoints=" + num + "&areGolden=" + "false", // body data type must match "Content-Type" header
                })
                .then(function (result) {
                    toClass(currClass)
                })

            }
        }
        function lower(par, num){
            let student = ""
            let studentEmail = ""
            if((par.id) == "golden"){
                for(let i = 0; i < par.parentElement.children.length; i++){
                    if(par.parentElement.children[i] == par){
                        let content = par.parentElement.children[i-1].textContent
                        student = content.substring(0, content.length-4)
                        break;
                    }
                }

                for(let i = 0; i < allStudents.length; i++){
                    if(allStudents[i][1] == student){
                        studentEmail = allStudents[i][0]
                        break;
                    }
                }

                fetch("/addPoints", {
                    method: 'POST',
                    headers: {
                        //'Content-Type': 'application/url',
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: "AdminU=" + email + "&AdminP=" + password + "&username=" + studentEmail + "&numPoints=" + num*-1 + "&areGolden=" + "true", // body data type must match "Content-Type" header
                })
                .then(function (result) {
                    toClass(currClass)
                })       
            }else{
                for(let i = 0; i < par.parentElement.children.length; i++){
                    if(par.parentElement.children[i] == par){
                        let content = par.parentElement.children[i-2].textContent
                        student = content.substring(0, content.length-4)
                        break;
                    }
                }

                for(let i = 0; i < allStudents.length; i++){
                    if(allStudents[i][1] == student){
                        studentEmail = allStudents[i][0]
                        break;
                    }
                }

                fetch("/addPoints", {
                    method: 'POST',
                    headers: {
                        //'Content-Type': 'application/url',
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: "AdminU=" + email + "&AdminP=" + password + "&username=" + studentEmail + "&numPoints=" + num*-1 + "&areGolden=" + "false", // body data type must match "Content-Type" header
                })
                .then(function (result) {
                    toClass(currClass)
                })
            }
        }

        function changeValue(par, num) {
            let student = "";
            if((par.id) == "golden"){
                for(let i = 0; i < par.parentElement.children.length; i++){
                    if(par.parentElement.children[i] == par){
                        let content = par.parentElement.children[i-1].textContent
                        student = content.substring(0, content.length-4)
                        break;
                    }
                }

                for(let i = 0; i < allStudents.length; i++){
                    if(allStudents[i][1] == student){
                        studentEmail = allStudents[i][0]
                        break;
                    }
                }

                fetch("/setPoints", {
                    method: 'POST',
                    headers: {
                        //'Content-Type': 'application/url',
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: "AdminU=" + email + "&AdminP=" + password + "&username=" + studentEmail + "&numPoints=" + num + "&areGolden=" + "true", // body data type must match "Content-Type" header
                })
                .then(function (result) {
                    toClass(currClass)
                })
            }else{
                for(let i = 0; i < par.parentElement.children.length; i++){
                    if(par.parentElement.children[i] == par){
                        let content = par.parentElement.children[i-2].textContent
                        student = content.substring(0, content.length-4)
                        break;
                    }
                }

                for(let i = 0; i < allStudents.length; i++){
                    if(allStudents[i][1] == student){
                        studentEmail = allStudents[i][0]
                        break;
                    }
                }

                fetch("/setPoints", {
                    method: 'POST',
                    headers: {
                        //'Content-Type': 'application/url',
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: "AdminU=" + email + "&AdminP=" + password + "&username=" + studentEmail + "&numPoints=" + num + "&areGolden=" + "false", // body data type must match "Content-Type" header
                })
                .then(function (result) {
                    toClass(currClass)
                })
            }
        }
    </script>
</body>
</html>